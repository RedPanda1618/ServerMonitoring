<source>
  @type forward
  port 24224
  bind "0.0.0.0"
</source>


# Forward the received audit logs to Loki
<match go.audit.**> # Match the tag from the monitored target (e.g., go.audit.raw)
  @type loki
  url "http://loki:3100" # Loki's Push API endpoint

  extra_labels {"job":"audit"}

  <label>
    hostname
    user
    comm
    exe
    success
    proctitle
  </label>


  <buffer>
    @type file
    path /fluentd/buffer/loki_audit # Path for the buffer file
    flush_mode interval
    flush_interval 1s                  # Flush interval to Loki
    flush_at_shutdown true
    retry_forever true
    chunk_limit_size 1M
    queue_limit_length 512
  </buffer>
</match>

# Output Fluentd's own logs to stdout (for debugging)
# Changed to use <label @FLUENT_LOG> as per previous warnings
<label @FLUENT_LOG>
  <match fluent.**> # Fluentd's internal log events (warn, error, etc.)
    @type stdout
  </match>
</label>